# Biopesca tri 1, 2025####
rm()
setwd("C:/Users/lg_ri/Dropbox/Postdoc/UNIOESTE/Relatórios Itaipu/R biopesca/Anual 2025")
library(readxl)
library(vegan)
library(dplyr)
library(ggplot2)
library(openxlsx)
BioAnual23 <- data.frame(read_xlsx("Biopesca_2025_ANUAL.xlsx", sheet="2025"))
BioAnual23 <- BioAnual23 %>%
  filter(tolower(Zona) != "montante")
Ord <- levels(factor(BioAnual23$Ordem))
Fam <- levels(factor(BioAnual23$Familia))
Spp <- levels(factor(BioAnual23$Genero))
Comp <- levels(factor(interaction(BioAnual23$Ordem,
                                  BioAnual23$Familia,
                                  BioAnual23$Genero)))
Comp # Lista de espécie
BioAnual23$Mes <- format(BioAnual23$Data, "%b %Y") # Data em (mmm aaaa)
BioAnual23$Mes <- factor(BioAnual23$Mes)
BioAnual23$Seq <- seq(nrow(BioAnual23))

##################################
### VALORES
Preco<-BioAnual23[BioAnual23$Preço.Inteiro..Particular.>0,]
Preco<-Preco[-which(is.na(Preco$Preço.Inteiro..Particular.)),c("Zona","Espécie","Preço.Inteiro..Particular.")]
Preco
tapply(Preco$Preço.Inteiro..Particular.,interaction(Preco$Zona,Preco$Espécie), mean)
tapply(Preco$Preço.Inteiro..Particular.,interaction(Preco$Zona,Preco$Espécie), sd)
names(BioAnual23)

# Define a vector of names to be replaced
names_to_replace <- c("Ageneiosus inermis","Ageneiosus ucayalensis","Astronotus crassipinnis","Auchenipterus osteomystax","Catathyridium jenynsii",
                      "Cichla kelberi","Cichla piquiti","Geophagus sveni","Hemiodus orthonops","Hoplerythrinus unitaeniatus","Hoplias mbigua",
                      "Hoplias misionera","Hoplias sp.3","Hoplias sp.2","Hypophthalmus oremaculatus","Hypostomus cochliodon","Hypostomus regani","Hypostomus ternetzi",
                      "Iheringichthys labrosus","Leporinus friderici","Leporinus lacustris","Loricariichthys platymetopon",
                      "Loricariichthys rostratus","Megalancistrus parananus","Megaleporinus macrocephalus","Megaleporinus obtusidens",
                      "Megaleporinus piavussu","Metynnis lippincottianus","Oreochromis niloticus","Piaractus mesopotamicus","Pimelodella avanhandavae",
                      "Pimelodus maculatus","Pimelodus mysteriosus","Pimelodus ornatus","Pinirampus pirinampu","Plagioscion squamosissimus",
                      "Potamotrygon amandae","Potamotrygon falkneri","Prochilodus lineatus","Pseudoplatystoma corruscans","Pterodoras granulosus",
                      "Pterygoplichthys ambrosettii","Rhaphiodon vulpinus","Rhinelepis aspera","Satanoperca setepele","Schizodon altoparanae",
                      "Schizodon borellii","Schizodon nasutus","Serrasalmus maculatus","Serrasalmus maculatus (preta)","Serrasalmus marginatus",
                      "Sorubim lima","Trachelyopterus galeatus","Traíra","Hemisorubim platyrhynchos","Salminus brasiliensis","Zungaro jahu","Cyprinus carpio","Clarias gariepinus","Crenicichla semifasciata","Crenicichla saxatilis",
                      "Crenicichla saxatilis", "Saxatilia britskii")

replacement_names <- c("Bocudo","Bocudo","Apaiari","Luz Baixa","Linguado","Tucunaré","Tucunaré","Cará","Bananinha","Jeju",
                       "Traíra","Traíra","Traíra","Traíra","Perna de Moça","Cascudo","Cascudo","Cascudo","Mandi","Piau","Piau","Cascudo",
                       "Cascudo","Cascudo","Piauçu","Piapara","Piapara","Palometa","Tilápia","Pacu","Mandi","Mandi","Mandi","Mandi","Barbado",
                       "Corvina","Raia","Raia","Curimba","Pintado","Armado","Cascudo","Dourado Cachorro","Cascudo","Cará","Piau","Piau","Piau",
                       "Piranha","Piranha","Piranha","Jurupensem","Cangati","Traíra","Jurupoca","Dourado","Jaú","Carpa","Bagre Africano","Joaninha","Joaninha",
                       "Joaninha","Joaninha")

# Substitute names in Genero column
Preco$Espécie <- ifelse(Preco$Espécie %in% names_to_replace,
                        replacement_names[match(Preco$Espécie, names_to_replace)],
                        Preco$Espécie)

# Filter out lines where Genero is not in the list of replacement names
Preco <- Preco[Preco$Espécie %in% replacement_names, ]

# Overall summary data frame
overall_summary <- aggregate(Preço.Inteiro..Particular. ~ Espécie, data = Preco, 
                             FUN = function(x) c(mean = mean(x), sd = sd(x)))


# Create a new column indicating Zona as "Geral" for overall summary data
overall_summary$Zona <- "Geral"

# Reorder columns
#overall_summary <- overall_summary[, c(2, 1, 3, 4, 5)]

overall_summary<-as.data.frame(overall_summary)

colnames(overall_summary)<-c("Espécies", "Preço", "Zona")

overall_summary$Preço_mean <- overall_summary$Preço[,1]
overall_summary$Preço_sd <- overall_summary$Preço[,2]

overall_summary <- overall_summary[, -2]

write.xlsx(overall_summary, file = "Preço geral peixe inteiro particular.xlsx")

# Zona-specific summary data frame
zona_summary <- aggregate(Preço.Inteiro..Particular. ~ Espécie + Zona, data = Preco, 
                          FUN = function(x) c(mean = mean(x), sd = sd(x)))

# Order zona_summary by Genero
zona_summary <- zona_summary %>% 
  arrange(Espécie)

# Define the complete set of Genero and Zona combinations
complete_set <- expand.grid(Espécie = unique(zona_summary$Espécie), 
                            Zona = c("Fluvial", "Transição", "Lacustre"))

# Merge zona_summary with the complete set to add missing combinations
zona_summary_complete <- merge(zona_summary, complete_set, by = c("Espécie", "Zona"), all = TRUE)

# Order the Zonas
zona_summary_complete$Zona <- factor(zona_summary_complete$Zona, levels = c("Fluvial", "Transição", "Lacustre"))

# Order zona_summary_complete by Genero and Zona
zona_summary_complete <- zona_summary_complete %>% 
  arrange(Espécie, Zona)

colnames(zona_summary_complete)<-c("Espécies","Zona", "Preço")

zona_summary_complete$Preço_mean <- zona_summary_complete$Preço[,1]
zona_summary_complete$Preço_sd <- zona_summary_complete$Preço[,2]

zona_summary_complete <- zona_summary_complete[, -3]

write.xlsx(zona_summary_complete, file = "Preço por zona peixe inteiro particular.xlsx")

#####################
### VALORES
Preco<-BioAnual23[BioAnual23$Preço.Filé..Particular.>0,]
Preco<-Preco[-which(is.na(Preco$Preço.Filé..Particular.)),c("Zona","Espécie","Preço.Filé..Particular.")]
Preco
tapply(Preco$Preço.Filé..Particular.,interaction(Preco$Zona,Preco$Espécie), mean)
tapply(Preco$Preço.Filé..Particular.,interaction(Preco$Zona,Preco$Espécie), sd)
names(BioAnual23)

# Define a vector of names to be replaced
names_to_replace <- c("Ageneiosus inermis","Ageneiosus ucayalensis","Astronotus crassipinnis","Auchenipterus osteomystax","Catathyridium jenynsii",
                      "Cichla kelberi","Cichla piquiti","Geophagus sveni","Hemiodus orthonops","Hoplerythrinus unitaeniatus","Hoplias mbigua",
                      "Hoplias misionera","Hoplias sp.3","Hoplias sp.2","Hypophthalmus oremaculatus","Hypostomus cochliodon","Hypostomus regani","Hypostomus ternetzi",
                      "Iheringichthys labrosus","Leporinus friderici","Leporinus lacustris","Loricariichthys platymetopon",
                      "Loricariichthys rostratus","Megalancistrus parananus","Megaleporinus macrocephalus","Megaleporinus obtusidens",
                      "Megaleporinus piavussu","Metynnis lippincottianus","Oreochromis niloticus","Piaractus mesopotamicus","Pimelodella avanhandavae",
                      "Pimelodus maculatus","Pimelodus mysteriosus","Pimelodus ornatus","Pinirampus pirinampu","Plagioscion squamosissimus",
                      "Potamotrygon amandae","Potamotrygon falkneri","Prochilodus lineatus","Pseudoplatystoma corruscans","Pterodoras granulosus",
                      "Pterygoplichthys ambrosettii","Rhaphiodon vulpinus","Rhinelepis aspera","Satanoperca setepele","Schizodon altoparanae",
                      "Schizodon borellii","Schizodon nasutus","Serrasalmus maculatus","Serrasalmus maculatus (preta)","Serrasalmus marginatus",
                      "Sorubim lima","Trachelyopterus galeatus","Traíra","Hemisorubim platyrhynchos","Salminus brasiliensis","Zungaro jahu","Cyprinus carpio","Clarias gariepinus","Crenicichla semifasciata","Crenicichla saxatilis",
                      "Crenicichla saxatilis", "Saxatilia britskii")

replacement_names <- c("Bocudo","Bocudo","Apaiari","Luz Baixa","Linguado","Tucunaré","Tucunaré","Cará","Bananinha","Jeju",
                       "Traíra","Traíra","Traíra","Traíra","Perna de Moça","Cascudo","Cascudo","Cascudo","Mandi","Piau","Piau","Cascudo",
                       "Cascudo","Cascudo","Piauçu","Piapara","Piapara","Palometa","Tilápia","Pacu","Mandi","Mandi","Mandi","Mandi","Barbado",
                       "Corvina","Raia","Raia","Curimba","Pintado","Armado","Cascudo","Dourado Cachorro","Cascudo","Cará","Piau","Piau","Piau",
                       "Piranha","Piranha","Piranha","Jurupensem","Cangati","Traíra","Jurupoca","Dourado","Jaú","Carpa","Bagre Africano","Joaninha","Joaninha",
                       "Joaninha","Joaninha")

# Substitute names in Genero column
Preco$Espécie <- ifelse(Preco$Espécie %in% names_to_replace,
                        replacement_names[match(Preco$Espécie, names_to_replace)],
                        Preco$Espécie)

# Filter out lines where Genero is not in the list of replacement names
Preco <- Preco[Preco$Espécie %in% replacement_names, ]

# Overall summary data frame
overall_summary <- aggregate(Preço.Filé..Particular. ~ Espécie, data = Preco, 
                             FUN = function(x) c(mean = mean(x), sd = sd(x)))


# Create a new column indicating Zona as "Geral" for overall summary data
overall_summary$Zona <- "Geral"

# Reorder columns
#overall_summary <- overall_summary[, c(2, 1, 3, 4, 5)]

overall_summary<-as.data.frame(overall_summary)

colnames(overall_summary)<-c("Espécies", "Preço", "Zona")

overall_summary$Preço_mean <- overall_summary$Preço[,1]
overall_summary$Preço_sd <- overall_summary$Preço[,2]

overall_summary <- overall_summary[, -2]

write.xlsx(overall_summary, file = "Preço geral peixe filé particular.xlsx")

# Zona-specific summary data frame
zona_summary <- aggregate(Preço.Filé..Particular. ~ Espécie + Zona, data = Preco, 
                          FUN = function(x) c(mean = mean(x), sd = sd(x)))

# Order zona_summary by Genero
zona_summary <- zona_summary %>% 
  arrange(Espécie)

# Define the complete set of Genero and Zona combinations
complete_set <- expand.grid(Espécie = unique(zona_summary$Espécie), 
                            Zona = c("Fluvial", "Transição", "Lacustre"))

# Merge zona_summary with the complete set to add missing combinations
zona_summary_complete <- merge(zona_summary, complete_set, by = c("Espécie", "Zona"), all = TRUE)

# Order the Zonas
zona_summary_complete$Zona <- factor(zona_summary_complete$Zona, levels = c("Fluvial", "Transição", "Lacustre"))

# Order zona_summary_complete by Genero and Zona
zona_summary_complete <- zona_summary_complete %>% 
  arrange(Espécie, Zona)

colnames(zona_summary_complete)<-c("Espécies","Zona", "Preço")

zona_summary_complete$Preço_mean <- zona_summary_complete$Preço[,1]
zona_summary_complete$Preço_sd <- zona_summary_complete$Preço[,2]

zona_summary_complete <- zona_summary_complete[, -3]

write.xlsx(zona_summary_complete, file = "Preço por zona peixe filé particular.xlsx")

#####################
##############
### VALORES
Preco<-BioAnual23[BioAnual23$Preço.Inteiro..Peixeiro.>0,]
Preco<-Preco[-which(is.na(Preco$Preço.Inteiro..Peixeiro.)),c("Zona","Espécie","Preço.Inteiro..Peixeiro.")]
Preco
tapply(Preco$Preço.Inteiro..Peixeiro.,interaction(Preco$Zona,Preco$Espécie), mean)
tapply(Preco$Preço.Inteiro..Peixeiro.,interaction(Preco$Zona,Preco$Espécie), sd)
names(BioAnual23)

# Define a vector of names to be replaced
names_to_replace <- c("Ageneiosus inermis","Ageneiosus ucayalensis","Astronotus crassipinnis","Auchenipterus osteomystax","Catathyridium jenynsii",
                      "Cichla kelberi","Cichla piquiti","Geophagus sveni","Hemiodus orthonops","Hoplerythrinus unitaeniatus","Hoplias mbigua",
                      "Hoplias misionera","Hoplias sp.3","Hoplias sp.2","Hypophthalmus oremaculatus","Hypostomus cochliodon","Hypostomus regani","Hypostomus ternetzi",
                      "Iheringichthys labrosus","Leporinus friderici","Leporinus lacustris","Loricariichthys platymetopon",
                      "Loricariichthys rostratus","Megalancistrus parananus","Megaleporinus macrocephalus","Megaleporinus obtusidens",
                      "Megaleporinus piavussu","Metynnis lippincottianus","Oreochromis niloticus","Piaractus mesopotamicus","Pimelodella avanhandavae",
                      "Pimelodus maculatus","Pimelodus mysteriosus","Pimelodus ornatus","Pinirampus pirinampu","Plagioscion squamosissimus",
                      "Potamotrygon amandae","Potamotrygon falkneri","Prochilodus lineatus","Pseudoplatystoma corruscans","Pterodoras granulosus",
                      "Pterygoplichthys ambrosettii","Rhaphiodon vulpinus","Rhinelepis aspera","Satanoperca setepele","Schizodon altoparanae",
                      "Schizodon borellii","Schizodon nasutus","Serrasalmus maculatus","Serrasalmus maculatus (preta)","Serrasalmus marginatus",
                      "Sorubim lima","Trachelyopterus galeatus","Traíra","Hemisorubim platyrhynchos","Salminus brasiliensis","Zungaro jahu","Cyprinus carpio","Clarias gariepinus","Crenicichla semifasciata","Crenicichla saxatilis",
                      "Crenicichla saxatilis", "Saxatilia britskii")

replacement_names <- c("Bocudo","Bocudo","Apaiari","Luz Baixa","Linguado","Tucunaré","Tucunaré","Cará","Bananinha","Jeju",
                       "Traíra","Traíra","Traíra","Traíra","Perna de Moça","Cascudo","Cascudo","Cascudo","Mandi","Piau","Piau","Cascudo",
                       "Cascudo","Cascudo","Piauçu","Piapara","Piapara","Palometa","Tilápia","Pacu","Mandi","Mandi","Mandi","Mandi","Barbado",
                       "Corvina","Raia","Raia","Curimba","Pintado","Armado","Cascudo","Dourado Cachorro","Cascudo","Cará","Piau","Piau","Piau",
                       "Piranha","Piranha","Piranha","Jurupensem","Cangati","Traíra","Jurupoca","Dourado","Jaú","Carpa","Bagre Africano","Joaninha","Joaninha",
                       "Joaninha","Joaninha")

# Substitute names in Genero column
Preco$Espécie <- ifelse(Preco$Espécie %in% names_to_replace,
                        replacement_names[match(Preco$Espécie, names_to_replace)],
                        Preco$Espécie)

# Filter out lines where Genero is not in the list of replacement names
Preco <- Preco[Preco$Espécie %in% replacement_names, ]

# Overall summary data frame
overall_summary <- aggregate(Preço.Inteiro..Peixeiro. ~ Espécie, data = Preco, 
                             FUN = function(x) c(mean = mean(x), sd = sd(x)))


# Create a new column indicating Zona as "Geral" for overall summary data
overall_summary$Zona <- "Geral"

# Reorder columns
#overall_summary <- overall_summary[, c(2, 1, 3, 4, 5)]

overall_summary<-as.data.frame(overall_summary)

colnames(overall_summary)<-c("Espécies", "Preço", "Zona")

overall_summary$Preço_mean <- overall_summary$Preço[,1]
overall_summary$Preço_sd <- overall_summary$Preço[,2]

overall_summary <- overall_summary[, -2]

write.xlsx(overall_summary, file = "Preço geral peixe inteiro peixeiro.xlsx")

# Zona-specific summary data frame
zona_summary <- aggregate(Preço.Inteiro..Peixeiro. ~ Espécie + Zona, data = Preco, 
                          FUN = function(x) c(mean = mean(x), sd = sd(x)))

# Order zona_summary by Genero
zona_summary <- zona_summary %>% 
  arrange(Espécie)

# Define the complete set of Genero and Zona combinations
complete_set <- expand.grid(Espécie = unique(zona_summary$Espécie), 
                            Zona = c("Fluvial", "Transição", "Lacustre"))

# Merge zona_summary with the complete set to add missing combinations
zona_summary_complete <- merge(zona_summary, complete_set, by = c("Espécie", "Zona"), all = TRUE)

# Order the Zonas
zona_summary_complete$Zona <- factor(zona_summary_complete$Zona, levels = c("Fluvial", "Transição", "Lacustre"))

# Order zona_summary_complete by Genero and Zona
zona_summary_complete <- zona_summary_complete %>% 
  arrange(Espécie, Zona)

colnames(zona_summary_complete)<-c("Espécies","Zona", "Preço")

zona_summary_complete$Preço_mean <- zona_summary_complete$Preço[,1]
zona_summary_complete$Preço_sd <- zona_summary_complete$Preço[,2]

zona_summary_complete <- zona_summary_complete[, -3]

write.xlsx(zona_summary_complete, file = "Preço por zona peixe inteiro peixeiro.xlsx")

#####################
##############
### VALORES
Preco<-BioAnual23[BioAnual23$Preço.Filé..Peixeiro.>0,]
Preco<-Preco[-which(is.na(Preco$Preço.Filé..Peixeiro.)),c("Zona","Espécie","Preço.Filé..Peixeiro.")]
Preco
tapply(Preco$Preço.Filé..Peixeiro.,interaction(Preco$Zona,Preco$Espécie), mean)
tapply(Preco$Preço.Filé..Peixeiro.,interaction(Preco$Zona,Preco$Espécie), sd)
names(BioAnual23)

# Define a vector of names to be replaced
names_to_replace <- c("Ageneiosus inermis","Ageneiosus ucayalensis","Astronotus crassipinnis","Auchenipterus osteomystax","Catathyridium jenynsii",
                      "Cichla kelberi","Cichla piquiti","Geophagus sveni","Hemiodus orthonops","Hoplerythrinus unitaeniatus","Hoplias mbigua",
                      "Hoplias misionera","Hoplias sp.3","Hoplias sp.2","Hypophthalmus oremaculatus","Hypostomus cochliodon","Hypostomus regani","Hypostomus ternetzi",
                      "Iheringichthys labrosus","Leporinus friderici","Leporinus lacustris","Loricariichthys platymetopon",
                      "Loricariichthys rostratus","Megalancistrus parananus","Megaleporinus macrocephalus","Megaleporinus obtusidens",
                      "Megaleporinus piavussu","Metynnis lippincottianus","Oreochromis niloticus","Piaractus mesopotamicus","Pimelodella avanhandavae",
                      "Pimelodus maculatus","Pimelodus mysteriosus","Pimelodus ornatus","Pinirampus pirinampu","Plagioscion squamosissimus",
                      "Potamotrygon amandae","Potamotrygon falkneri","Prochilodus lineatus","Pseudoplatystoma corruscans","Pterodoras granulosus",
                      "Pterygoplichthys ambrosettii","Rhaphiodon vulpinus","Rhinelepis aspera","Satanoperca setepele","Schizodon altoparanae",
                      "Schizodon borellii","Schizodon nasutus","Serrasalmus maculatus","Serrasalmus maculatus (preta)","Serrasalmus marginatus",
                      "Sorubim lima","Trachelyopterus galeatus","Traíra","Hemisorubim platyrhynchos","Salminus brasiliensis","Zungaro jahu","Cyprinus carpio","Clarias gariepinus","Crenicichla semifasciata","Crenicichla saxatilis",
                      "Crenicichla saxatilis", "Saxatilia britskii")

replacement_names <- c("Bocudo","Bocudo","Apaiari","Luz Baixa","Linguado","Tucunaré","Tucunaré","Cará","Bananinha","Jeju",
                       "Traíra","Traíra","Traíra","Traíra","Perna de Moça","Cascudo","Cascudo","Cascudo","Mandi","Piau","Piau","Cascudo",
                       "Cascudo","Cascudo","Piauçu","Piapara","Piapara","Palometa","Tilápia","Pacu","Mandi","Mandi","Mandi","Mandi","Barbado",
                       "Corvina","Raia","Raia","Curimba","Pintado","Armado","Cascudo","Dourado Cachorro","Cascudo","Cará","Piau","Piau","Piau",
                       "Piranha","Piranha","Piranha","Jurupensem","Cangati","Traíra","Jurupoca","Dourado","Jaú","Carpa","Bagre Africano","Joaninha","Joaninha",
                       "Joaninha","Joaninha")

# Substitute names in Genero column
Preco$Espécie <- ifelse(Preco$Espécie %in% names_to_replace,
                        replacement_names[match(Preco$Espécie, names_to_replace)],
                        Preco$Espécie)

# Filter out lines where Genero is not in the list of replacement names
Preco <- Preco[Preco$Espécie %in% replacement_names, ]

# Overall summary data frame
overall_summary <- aggregate(Preço.Filé..Peixeiro. ~ Espécie, data = Preco, 
                             FUN = function(x) c(mean = mean(x), sd = sd(x)))


# Create a new column indicating Zona as "Geral" for overall summary data
overall_summary$Zona <- "Geral"

# Reorder columns
#overall_summary <- overall_summary[, c(2, 1, 3, 4, 5)]

overall_summary<-as.data.frame(overall_summary)

colnames(overall_summary)<-c("Espécies", "Preço", "Zona")

overall_summary$Preço_mean <- overall_summary$Preço[,1]
overall_summary$Preço_sd <- overall_summary$Preço[,2]

overall_summary <- overall_summary[, -2]

write.xlsx(overall_summary, file = "Preço geral peixe filé peixeiro.xlsx")

# Zona-specific summary data frame
zona_summary <- aggregate(Preço.Filé..Peixeiro. ~ Espécie + Zona, data = Preco, 
                          FUN = function(x) c(mean = mean(x), sd = sd(x)))

# Order zona_summary by Genero
zona_summary <- zona_summary %>% 
  arrange(Espécie)

# Define the complete set of Genero and Zona combinations
complete_set <- expand.grid(Espécie = unique(zona_summary$Espécie), 
                            Zona = c("Fluvial", "Transição", "Lacustre"))

# Merge zona_summary with the complete set to add missing combinations
zona_summary_complete <- merge(zona_summary, complete_set, by = c("Espécie", "Zona"), all = TRUE)

# Order the Zonas
zona_summary_complete$Zona <- factor(zona_summary_complete$Zona, levels = c("Fluvial", "Transição", "Lacustre"))

# Order zona_summary_complete by Genero and Zona
zona_summary_complete <- zona_summary_complete %>% 
  arrange(Espécie, Zona)

colnames(zona_summary_complete)<-c("Espécies","Zona", "Preço")

zona_summary_complete$Preço_mean <- zona_summary_complete$Preço[,1]
zona_summary_complete$Preço_sd <- zona_summary_complete$Preço[,2]

zona_summary_complete <- zona_summary_complete[, -3]

write.xlsx(zona_summary_complete, file = "Preço por zona peixe filé peixeiro.xlsx")

#######################################
# Biopesca tri 1, 2025 - SOMENTE MONTANTE (tabelas de MONTANTE) ####
rm(list = ls())
setwd("C:/Users/lg_ri/Dropbox/Postdoc/UNIOESTE/Relatórios Itaipu/R biopesca/Anual 2025")

library(readxl)
library(vegan)
library(dplyr)
library(ggplot2)
library(openxlsx)

BioAnual23 <- data.frame(read_xlsx("Biopesca_2025_ANUAL.xlsx", sheet = "2025"))

# >>> Aqui a mudança principal: mantém SOMENTE MONTANTE
BioAnual23 <- BioAnual23 %>%
  filter(tolower(Zona) == "montante")

Ord <- levels(factor(BioAnual23$Ordem))
Fam <- levels(factor(BioAnual23$Familia))
Spp <- levels(factor(BioAnual23$Genero))
Comp <- levels(factor(interaction(BioAnual23$Ordem,
                                  BioAnual23$Familia,
                                  BioAnual23$Genero)))
Comp # Lista de espécie

BioAnual23$Mes <- format(BioAnual23$Data, "%b %Y") # Data em (mmm aaaa)
BioAnual23$Mes <- factor(BioAnual23$Mes)
BioAnual23$Seq <- seq(nrow(BioAnual23))

##################################
# Dicionário de nomes (mantido igual ao seu)
names_to_replace <- c("Ageneiosus inermis","Ageneiosus ucayalensis","Astronotus crassipinnis","Auchenipterus osteomystax","Catathyridium jenynsii",
                      "Cichla kelberi","Cichla piquiti","Geophagus sveni","Hemiodus orthonops","Hoplerythrinus unitaeniatus","Hoplias mbigua",
                      "Hoplias misionera","Hoplias sp.3","Hoplias sp.2","Hypophthalmus oremaculatus","Hypostomus cochliodon","Hypostomus regani","Hypostomus ternetzi",
                      "Iheringichthys labrosus","Leporinus friderici","Leporinus lacustris","Loricariichthys platymetopon",
                      "Loricariichthys rostratus","Megalancistrus parananus","Megaleporinus macrocephalus","Megaleporinus obtusidens",
                      "Megaleporinus piavussu","Metynnis lippincottianus","Oreochromis niloticus","Piaractus mesopotamicus","Pimelodella avanhandavae",
                      "Pimelodus maculatus","Pimelodus mysteriosus","Pimelodus ornatus","Pinirampus pirinampu","Plagioscion squamosissimus",
                      "Potamotrygon amandae","Potamotrygon falkneri","Prochilodus lineatus","Pseudoplatystoma corruscans","Pterodoras granulosus",
                      "Pterygoplichthys ambrosettii","Rhaphiodon vulpinus","Rhinelepis aspera","Satanoperca setepele","Schizodon altoparanae",
                      "Schizodon borellii","Schizodon nasutus","Serrasalmus maculatus","Serrasalmus maculatus (preta)","Serrasalmus marginatus",
                      "Sorubim lima","Trachelyopterus galeatus","Traíra","Hemisorubim platyrhynchos","Salminus brasiliensis","Zungaro jahu","Cyprinus carpio","Clarias gariepinus","Crenicichla semifasciata","Crenicichla saxatilis",
                      "Crenicichla saxatilis", "Saxatilia britskii")

replacement_names <- c("Bocudo","Bocudo","Apaiari","Luz Baixa","Linguado","Tucunaré","Tucunaré","Cará","Bananinha","Jeju",
                       "Traíra","Traíra","Traíra","Traíra","Perna de Moça","Cascudo","Cascudo","Cascudo","Mandi","Piau","Piau","Cascudo",
                       "Cascudo","Cascudo","Piauçu","Piapara","Piapara","Palometa","Tilápia","Pacu","Mandi","Mandi","Mandi","Mandi","Barbado",
                       "Corvina","Raia","Raia","Curimba","Pintado","Armado","Cascudo","Dourado Cachorro","Cascudo","Cará","Piau","Piau","Piau",
                       "Piranha","Piranha","Piranha","Jurupensem","Cangati","Traíra","Jurupoca","Dourado","Jaú","Carpa","Bagre Africano","Joaninha","Joaninha",
                       "Joaninha","Joaninha")

##################################
# Função para recodificar nomes (sem alterar sua lógica)
recodificar_especie <- function(df) {
  df$Espécie <- ifelse(df$Espécie %in% names_to_replace,
                       replacement_names[match(df$Espécie, names_to_replace)],
                       df$Espécie)
  df <- df[df$Espécie %in% replacement_names, ]
  return(df)
}

##################################
# Função para gerar tabela de resumo (MONTANTE) no mesmo padrão do seu output
# - Mantém as colunas: Espécies, Zona, Preço_mean, Preço_sd
# - "Zona" fica como "Montante" (porque aqui não existe Geral = soma de 3 zonas)
resumo_montante <- function(Preco, preco_col) {
  out <- aggregate(Preco[[preco_col]] ~ Espécie, data = Preco,
                   FUN = function(x) c(mean = mean(x), sd = sd(x)))
  out <- as.data.frame(out)
  colnames(out) <- c("Espécies", "Preço")
  out$Zona <- "Montante"
  out$Preço_mean <- out$Preço[, 1]
  out$Preço_sd   <- out$Preço[, 2]
  out <- out[, c("Espécies", "Zona", "Preço_mean", "Preço_sd")]
  out
}

##################################
### 1) PREÇO INTEIRO (PARTICULAR) - MONTANTE
Preco <- BioAnual23[BioAnual23$Preço.Inteiro..Particular. > 0, ]
Preco <- Preco[-which(is.na(Preco$Preço.Inteiro..Particular.)), c("Zona", "Espécie", "Preço.Inteiro..Particular.")]
Preco
tapply(Preco$Preço.Inteiro..Particular., interaction(Preco$Zona, Preco$Espécie), mean)
tapply(Preco$Preço.Inteiro..Particular., interaction(Preco$Zona, Preco$Espécie), sd)
names(BioAnual23)

Preco <- recodificar_especie(Preco)

# >>> Tabela final MONTANTE (substitui o "geral" antigo)
montante_summary <- resumo_montante(Preco, "Preço.Inteiro..Particular.")
write.xlsx(montante_summary, file = "Preço geral peixe inteiro particular_MONTANTE.xlsx")


#####################
### 2) PREÇO FILÉ (PARTICULAR) - MONTANTE
Preco <- BioAnual23[BioAnual23$Preço.Filé..Particular. > 0, ]
Preco <- Preco[-which(is.na(Preco$Preço.Filé..Particular.)), c("Zona", "Espécie", "Preço.Filé..Particular.")]
Preco
tapply(Preco$Preço.Filé..Particular., interaction(Preco$Zona, Preco$Espécie), mean)
tapply(Preco$Preço.Filé..Particular., interaction(Preco$Zona, Preco$Espécie), sd)
names(BioAnual23)

Preco <- recodificar_especie(Preco)

montante_summary <- resumo_montante(Preco, "Preço.Filé..Particular.")
write.xlsx(montante_summary, file = "Preço geral peixe filé particular_MONTANTE.xlsx")

#####################
### 3) PREÇO INTEIRO (PEIXEIRO) - MONTANTE
Preco <- BioAnual23[BioAnual23$Preço.Inteiro..Peixeiro. > 0, ]
Preco <- Preco[-which(is.na(Preco$Preço.Inteiro..Peixeiro.)), c("Zona", "Espécie", "Preço.Inteiro..Peixeiro.")]
Preco
tapply(Preco$Preço.Inteiro..Peixeiro., interaction(Preco$Zona, Preco$Espécie), mean)
tapply(Preco$Preço.Inteiro..Peixeiro., interaction(Preco$Zona, Preco$Espécie), sd)
names(BioAnual23)

Preco <- recodificar_especie(Preco)

montante_summary <- resumo_montante(Preco, "Preço.Inteiro..Peixeiro.")
write.xlsx(montante_summary, file = "Preço geral peixe inteiro peixeiro_MONTANTE.xlsx")

#####################
### 4) PREÇO FILÉ (PEIXEIRO) - MONTANTE
Preco <- BioAnual23[BioAnual23$Preço.Filé..Peixeiro. > 0, ]
Preco <- Preco[-which(is.na(Preco$Preço.Filé..Peixeiro.)), c("Zona", "Espécie", "Preço.Filé..Peixeiro.")]
Preco
tapply(Preco$Preço.Filé..Peixeiro., interaction(Preco$Zona, Preco$Espécie), mean)
tapply(Preco$Preço.Filé..Peixeiro., interaction(Preco$Zona, Preco$Espécie), sd)
names(BioAnual23)

Preco <- recodificar_especie(Preco)

montante_summary <- resumo_montante(Preco, "Preço.Filé..Peixeiro.")
write.xlsx(montante_summary, file = "Preço geral peixe filé peixeiro_MONTANTE.xlsx")

#######################################

